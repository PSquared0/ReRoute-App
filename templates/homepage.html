{% extends 'base.html' %}
{% block content %}

  <h1>Reroute</h1>

  <h2>Reroute, pointing you in the right direction</h2>


  <h3>Pick a Bus Line</h3>

    <ul class="dropdown">
    <form action='/bus_detail', method="get">
    <select name="bus">
    {% for bus in buses %}
    <option value="{{ bus.bus_name }}">{{ bus.bus_name }}
    {% endfor %}
    </select>
    <br><br>
    <input type="submit">
    </form>
    </ul>

<p>OR</p>

<button onclick="getLocation()">Use Your Current Location</button>

<p id="location"></p>

<script>
var x = document.getElementById("location");

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(showPosition);
    } else {
        x.innerHTML = "Geolocation is not supported by this browser.";

        console.log(x.innerHTML)
    }
}


function showPosition(position) {
    x.innerHTML = "Latitude: " + position.coords.latitude +
    "<br>Longitude: " + position.coords.longitude;
}
</script>




<!-- ################################################################################ -->

    <script type="text/javascript" src="//maps.googleapis.com/maps/api/js?sensor=true&libraries=places"></script>

    <script type="text/javascript">
      var map;
      var infowindow;
      var service ;
      function initialize(lat,lng) 
      {
        var origin = new google.maps.LatLng(position.coords.latitude,position.coords.longitude;);
       
        map = new google.maps.Map(document.getElementById('map'), {
          mapTypeId: google.maps.MapTypeId.HYBRID,
          center: origin,
          zoom: 15
        });
        
        var request = {
          location: origin,
          radius: 2500,
          types: ['train_station','bus_station','subway_station','transit_station']
        };
        infowindow = new google.maps.InfoWindow();
        service = new google.maps.places.PlacesService(map);
        service.search(request, callback);
      }

      function callback(results, status) {
        if (status == google.maps.places.PlacesServiceStatus.OK) {
          for (var i = 0; i < results.length; i++) {
            createMarker(results[i]);
          }
        }
      }

      function createMarker(place) {
      
        var placeLoc = place.geometry.location;
        var marker = new google.maps.Marker({
          map: map,
          position: place.geometry.location
        });
        var content='<strong style="font-size:1.2em">'+place.name+'</strong>'+
                    '<br/><strong>Latitude:</strong>'+placeLoc.lat()+
                    '<br/><strong>Longitude:</strong>'+placeLoc.lng()+
                    '<br/><strong>Type:</strong>'+place.types[0]+
                    '<br/><strong>Rating:</strong>'+(place.rating||'n/a');
        var more_content='<img src="http://googleio2009-map.googlecode.com/svn-history/r2/trunk/app/images/loading.gif"/>';
        
        //make a request for further details
        service.getDetails({reference:place.reference}, function (place, status) 
                                    {
                                      if (status == google.maps.places.PlacesServiceStatus.OK) 
                                      {
                                        more_content='<hr/><strong><a href="'+place.url+'" target="details">Details</a>';
                                        
                                        if(place.website)
                                        {
                                          more_content+='<br/><br/><strong><a href="'+place.website+'" target="details">'+place.website+'</a>';
                                        }
                                      }
                                    });


        google.maps.event.addListener(marker, 'click', function() {
          
          infowindow.setContent(content+more_content);
          infowindow.open(map, this);
        });
      }

      google.maps.event.addDomListener(window, 'load', function(){initialize(1.299845,103.856292);});
    </script>
    <div id="map" style="height:400px;"></div>










 

{% endblock %}